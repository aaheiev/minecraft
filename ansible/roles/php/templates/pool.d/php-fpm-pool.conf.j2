[{{ fpm.pm.name|default ('www') }}]

user = {{ fpm.user|default ('www-data') }}
group = {{ fpm.group|default ('www-data') }}

listen = /run/php/{{ php_version }}-fpm.sock
listen.owner = {{ fpm.user|default ('www-data') }}
listen.group = {{ fpm.group|default ('www-data') }}

pm = dynamic

pm.max_children = {{ ansible_processor_vcpus * 16 }}
pm.start_servers = {{ ansible_processor_vcpus * 4 }}
pm.min_spare_servers = {{ ansible_processor_vcpus * 1 }}
pm.max_spare_servers = {{ ansible_processor_vcpus * 8 }}

pm.max_requests = {{ fpm.pm.max_requests|default (500) }}
pm.process_idle_timeout = {{ fpm.pm.process_idle_timeout|default ('10s') }}

catch_workers_output = yes
